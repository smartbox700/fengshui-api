name: keepalive-fengshui-api

on:
  schedule:
    - cron: "*/10 * * * *"   # 10분마다 (UTC 기준)
  workflow_dispatch: {}       # 수동 실행

permissions:
  contents: read

jobs:
  ping:
    runs-on: ubuntu-latest
    timeout-minutes: 3
    env:
      HEALTH_URL: https://fengshui-api.onrender.com/health
    steps:
      - name: Curl /health (retry 3x)
        run: |
          set -euo pipefail
          for i in 1 2 3; do
            echo "[Attempt $i] $HEALTH_URL"
            if curl -4 -fsS "$HEALTH_URL" \
                 --max-time 20 --connect-timeout 5 \
                 -H "User-Agent: keepalive-gha/1.0"; then
              echo "OK"
              exit 0
            fi
            echo "Retry in 20s..."
            sleep 20
          done
          echo "ERROR: health check failed after 3 attempts"
          exit 1
