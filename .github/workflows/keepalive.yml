name: Keep Render Awake

on:
  schedule:
    - cron: '*/12 * * * *'   # 12분마다 (UTC)
  workflow_dispatch:

jobs:
  ping:
    runs-on: ubuntu-latest
    timeout-minutes: 2
    steps:
      - name: Hit Render root (wake up)
        run: |
          URL="https://fengshui-api.onrender.com/"
          for i in {1..3}; do
            CODE=$(curl -s -o /dev/null -w "%{http_code}" "$URL") || true
            echo "Attempt $i => HTTP $CODE"
            if [ "$CODE" = "200" ]; then exit 0; fi
            sleep 10
          done
          exit 1

      # 비차단 검사: 실패해도 워크플로우는 계속 통과
      - name: Optional sanity POST to /evaluate (non-blocking)
        if: always()
        run: |
          curl -s -X POST "https://fengshui-api.onrender.com/evaluate" \
            -H "Content-Type: application/json" \
            -d '{"lat":37.56,"lon":126.97,"features":{"aspect_deg":180,"road":{"distance_m":50,"angle_diff_to_aspect":10}}}' \
            -o /dev/null -w "POST /evaluate => HTTP %{http_code}\n" || true
